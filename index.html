<!DOCTYPE html>
<html lang="en">
<head>
     <!--PropellerAds-->
    <script src="https://fpyf8.com/88/tag.min.js" data-zone="157210" async data-cfasync="false"></script>

    <script type='text/javascript' src='//pl26717244.profitableratecpm.com/bf/51/a4/bf51a42d984554beaaed4a58dcdb733d.js'></script>
    <script type='text/javascript' src='//pl26713337.profitableratecpm.com/64/66/f1/6466f1b7fea6c93f404f4ab49960b99c.js'></script>
    <script async="async" data-cfasync="false" src="//pl26713372.profitableratecpm.com/1a6d5fbc149d94ff8c697b1327966995/invoke.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinEarner Pro - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        accent: {
                            400: '#f59e0b',
                            500: '#d97706',
                            600: '#b45309'
                        },
                        success: {
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .dark .glass {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .dark .glass-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            min-height: 100vh;
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            max-width: 600px;
            width: 90%;
            margin: 1rem;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .hidden { display: none !important; }
        
        .admin-card {
            transition: all 0.3s ease;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .input-base {
            font-size: 16px;
        }
        
        .permission-denied {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            border: none;
        }
        
        .permission-granted {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            border: none;
        }
        
        .read-only-field {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(255, 255, 255, 0.1) !important;
        }
        
        .tab-active {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #3b82f6;
        }
        
        .user-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .user-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .warning-border {
            border: 2px solid #f59e0b;
            animation: warningPulse 2s infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { border-color: #f59e0b; }
            50% { border-color: #ef4444; }
        }
    </style>
</head>
<body class="gradient-bg text-white overflow-x-hidden">
    
    <!-- Navigation Header -->
    <nav class="glass sticky top-0 z-50 border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-shield-alt text-3xl text-red-400"></i>
                        <span class="text-xl font-bold">Admin Panel</span>
                        <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs">LIMITED</span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4" id="adminNav">
                    <span class="text-white/70" id="adminName">Not Logged In</span>
                    <button onclick="logoutAdmin()" class="glass px-4 py-2 rounded-xl hover:bg-white/20 transition-all" id="logoutBtn" style="display: none;">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto">
            <div class="glass rounded-2xl p-8">
                <h2 class="text-3xl font-bold mb-6 text-center">
                    <i class="fas fa-key text-red-400 mr-3"></i>
                    Admin Login
                </h2>
                
                <div class="bg-yellow-500/20 border border-yellow-500 rounded-lg p-4 mb-6">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-yellow-400 mr-3"></i>
                        <div class="text-sm">
                            <p class="font-semibold">Limited Admin Access</p>
                            <p class="text-yellow-200">You can only modify specific user data fields</p>
                        </div>
                    </div>
                </div>
                
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Admin Email</label>
                        <input type="email" id="adminEmail" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter admin email">
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="adminPassword" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter password">
                    </div>
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-6 rounded-xl hover:from-red-600 hover:to-red-700 font-semibold transition-all">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login as Admin
                        </button>
                    </div>
                    <div class="text-center pt-4">
                        <button type="button" onclick="showAdminRegistration()" class="text-blue-400 hover:text-blue-300 text-sm">
                            Need admin access? Register here
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="dashboardSection" class="hidden">
            
            <!-- Admin Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="admin-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-users text-4xl text-blue-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-blue-400" id="totalManagedUsers">0</h3>
                    <p class="text-white/70 text-sm">Managed Users</p>
                </div>
                <div class="admin-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-edit text-4xl text-green-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-green-400" id="totalModifications">0</h3>
                    <p class="text-white/70 text-sm">Modifications Today</p>
                </div>
                <div class="admin-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-clock text-4xl text-yellow-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-yellow-400" id="lastActivity">Never</h3>
                    <p class="text-white/70 text-sm">Last Activity</p>
                </div>
                <div class="admin-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-shield-check text-4xl text-purple-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-purple-400" id="adminLevel">Level 1</h3>
                    <p class="text-white/70 text-sm">Admin Level</p>
                </div>
            </div>

            <!-- User Management Tabs -->
            <div class="glass rounded-2xl p-6 mb-8">
                <div class="flex flex-wrap gap-4 mb-6">
                    <button onclick="switchTab('search')" class="tab-btn tab-active px-6 py-3 rounded-lg font-semibold transition-all" id="searchTab">
                        <i class="fas fa-search mr-2"></i>Find Users
                    </button>
                    <button onclick="switchTab('manage')" class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all" id="manageTab">
                        <i class="fas fa-users-cog mr-2"></i>Manage Users
                    </button>
                    <button onclick="switchTab('activity')" class="tab-btn px-6 py-3 rounded-lg font-semibold transition-all" id="activityTab">
                        <i class="fas fa-history mr-2"></i>Activity Log
                    </button>
                </div>

                <!-- Search Users Tab -->
                <div id="searchTabContent" class="tab-content">
                    <div class="mb-6">
                        <div class="flex gap-4 mb-4">
                            <input type="text" id="userSearchInput" placeholder="Search by email, name, or phone..." class="flex-1 px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base">
                            <button onclick="searchUsers()" class="bg-blue-500 hover:bg-blue-600 px-6 py-3 rounded-xl font-semibold transition-all">
                                <i class="fas fa-search mr-2"></i>Search
                            </button>
                        </div>
                        <div class="text-sm text-white/70">
                            <i class="fas fa-info-circle mr-2"></i>
                            You can only search and manage users you have permission for
                        </div>
                    </div>
                    
                    <div id="searchResults" class="space-y-3">
                        <p class="text-white/70 text-center">Enter search terms to find users</p>
                    </div>
                </div>

                <!-- Manage Users Tab -->
                <div id="manageTabContent" class="tab-content hidden">
                    <div id="managedUsersList" class="space-y-4">
                        <p class="text-white/70 text-center">No users assigned for management</p>
                    </div>
                </div>

                <!-- Activity Log Tab -->
                <div id="activityTabContent" class="tab-content hidden">
                    <div class="activity-log space-y-3" id="adminActivityLog">
                        <p class="text-white/70 text-center">No activity recorded</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div class="modal-overlay hidden" id="userEditModal">
        <div class="modal-content glass rounded-2xl p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-user-edit text-blue-400 mr-2"></i>
                    Edit User Data
                </h2>
                <button onclick="closeUserEditModal()" class="text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="bg-red-500/20 border border-red-500 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-red-400 mr-3"></i>
                    <div class="text-sm">
                        <p class="font-semibold">Limited Editing Permissions</p>
                        <p class="text-red-200">Some fields are read-only or have restrictions</p>
                    </div>
                </div>
            </div>

            <form id="userEditForm" class="space-y-4">
                <input type="hidden" id="editUserId">
                
                <!-- Basic Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Name <span class="text-gray-400">(Read Only)</span>
                        </label>
                        <input type="text" id="editUserName" readonly class="w-full px-4 py-3 glass-input rounded-xl text-white read-only-field input-base">
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Email <span class="text-gray-400">(Read Only)</span>
                        </label>
                        <input type="email" id="editUserEmail" readonly class="w-full px-4 py-3 glass-input rounded-xl text-white read-only-field input-base">
                    </div>
                </div>

                <!-- Editable Financial Data -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Coins <span class="text-yellow-400">(Can Decrease Only)</span>
                        </label>
                        <input type="number" id="editUserCoins" min="0" class="w-full px-4 py-3 glass-input rounded-xl text-white warning-border input-base">
                        <small class="text-yellow-300 text-xs">Original: <span id="originalCoins">0</span></small>
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Diamonds <span class="text-cyan-400">(Can Increase/Decrease)</span>
                        </label>
                        <input type="number" id="editUserDiamonds" min="0" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Earnings <span class="text-green-400">(Can Decrease Only)</span>
                        </label>
                        <input type="number" id="editUserEarnings" min="0" step="0.01" class="w-full px-4 py-3 glass-input rounded-xl text-white warning-border input-base">
                        <small class="text-green-300 text-xs">Original: à§³<span id="originalEarnings">0.00</span></small>
                    </div>
                </div>

                <!-- Activity Data -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Streak <span class="text-red-400">(Can Increase/Decrease)</span>
                        </label>
                        <input type="number" id="editUserStreak" min="0" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Achievement Points <span class="text-purple-400">(Can Modify)</span>
                        </label>
                        <input type="number" id="editAchievementPoints" min="0" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                    </div>
                </div>

                <!-- Status Controls -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Account Status</label>
                        <select id="editIsActive" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Games Unlocked</label>
                        <select id="editDailyUnlockedGames" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Videos Unlocked</label>
                        <select id="editDailyUnlockedVideos" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>

                <!-- Profile Data -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Location</label>
                        <input type="text" id="editUserLocation" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base" placeholder="City, Country">
                    </div>
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">
                            Gender <span class="text-gray-400">(Read Only)</span>
                        </label>
                        <input type="text" id="editUserGender" readonly class="w-full px-4 py-3 glass-input rounded-xl text-white read-only-field input-base">
                    </div>
                </div>

                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Bio</label>
                    <textarea id="editUserBio" rows="3" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base" placeholder="User bio..."></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-xl hover:from-green-600 hover:to-green-700 font-semibold transition-all">
                        <i class="fas fa-save mr-2"></i>Save Changes
                    </button>
                    <button type="button" onclick="closeUserEditModal()" class="flex-1 glass text-white py-3 px-6 rounded-xl hover:bg-white/20 font-semibold transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Registration Modal -->
    <div class="modal-overlay hidden" id="adminRegistrationModal">
        <div class="modal-content glass rounded-2xl p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-user-shield text-red-400 mr-2"></i>
                    Admin Registration
                </h2>
                <button onclick="hideAdminRegistration()" class="text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="bg-orange-500/20 border border-orange-500 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-orange-400 mr-3"></i>
                    <div class="text-sm">
                        <p class="font-semibold">Admin Access Request</p>
                        <p class="text-orange-200">Registration subject to approval by main admin</p>
                    </div>
                </div>
            </div>

            <form id="adminRegistrationForm" class="space-y-4">
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Full Name</label>
                    <input type="text" id="adminRegName" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter your full name">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Email</label>
                    <input type="email" id="adminRegEmail" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter your email">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Password</label>
                    <input type="password" id="adminRegPassword" required minlength="6" class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Create password">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Reason for Admin Access</label>
                    <textarea id="adminRegReason" required rows="3" class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Explain why you need admin access..."></textarea>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 px-6 rounded-xl hover:from-orange-600 hover:to-red-700 font-semibold transition-all">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Request
                    </button>
                    <button type="button" onclick="hideAdminRegistration()" class="flex-1 glass text-white py-3 px-6 rounded-xl hover:bg-white/20 font-semibold transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div class="modal-overlay hidden" id="customAlert">
        <div class="modal-content glass rounded-2xl p-8 text-center max-w-md">
            <i id="alertIcon" class="fas fa-info-circle text-5xl mb-4"></i>
            <p id="alertMessage" class="text-xl mb-6 text-white"></p>
            <button onclick="hideCustomAlert()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-xl hover:from-blue-600 hover:to-purple-700 font-semibold transition-all">
                OK
            </button>
        </div>
    </div>

    <script>
        // Admin Panel Configuration
        const adminConfig = {
            apiEndpoint: 'https://script.google.com/macros/s/AKfycbwzeoNtCleXecmpyEpfQMiZxNHizvl84nUipSj1FxTySFVhQrT-3K9Oo_7FiidM5HPL/exec',
            version: '1.0.0',
            permissions: {
                readOnly: ['name', 'email', 'phone', 'gender', 'referralCode', 'joinDate'],
                canDecrease: ['coins', 'earnings'],
                canModify: ['diamonds', 'streak', 'isActive', 'dailyUnlockedGames', 'dailyUnlockedVideos', 
                          'achievementPoints', 'bio', 'location', 'dateOfBirth', 'preferredLanguage',
                          'totalEarningsLifetime', 'totalActivitiesCompleted', 'loginStreak', 
                          'lastStreakUpdate', 'profilePicture', 'lastUnlockDate']
            }
        };

        class AdminPanel {
            constructor() {
                this.currentAdmin = null;
                this.selectedUser = null;
                this.managedUsers = [];
                this.activityLog = [];
                this.currentTab = 'search';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkAdminSession();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('adminLoginForm').addEventListener('submit', this.handleAdminLogin.bind(this));
                
                // Registration form
                document.getElementById('adminRegistrationForm').addEventListener('submit', this.handleAdminRegistration.bind(this));
                
                // User edit form
                document.getElementById('userEditForm').addEventListener('submit', this.handleUserEdit.bind(this));
                
                // Search input
                document.getElementById('userSearchInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.searchUsers();
                    }
                });

                // Coin validation
                document.getElementById('editUserCoins').addEventListener('input', this.validateCoinsInput.bind(this));
                document.getElementById('editUserEarnings').addEventListener('input', this.validateEarningsInput.bind(this));
            }

            checkAdminSession() {
                const adminSession = localStorage.getItem('adminSession');
                if (adminSession) {
                    try {
                        this.currentAdmin = JSON.parse(adminSession);
                        this.showDashboard();
                    } catch (e) {
                        localStorage.removeItem('adminSession');
                    }
                }
            }

            async handleAdminLogin(e) {
                e.preventDefault();
                
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;
                
                try {
                    // Simulate admin login (in real app, this would validate against admin database)
                    const adminData = await this.validateAdmin(email, password);
                    
                    if (adminData) {
                        this.currentAdmin = adminData;
                        localStorage.setItem('adminSession', JSON.stringify(adminData));
                        this.showDashboard();
                        this.logActivity('login', `Admin ${email} logged in`);
                    } else {
                        showCustomAlert('Invalid admin credentials', 'error');
                    }
                } catch (error) {
                    showCustomAlert('Login failed. Please try again.', 'error');
                }
            }

            async validateAdmin(email, password) {
                // For demo purposes, allow any email ending with @admin.coinearner
                // In real implementation, this would check against admin database
                if (email.endsWith('@admin.coinearner') || email === 'admin@coinearner.com') {
                    return {
                        id: 'admin_' + Date.now(),
                        name: email.split('@')[0],
                        email: email,
                        level: 1,
                        permissions: ['user_edit_limited'],
                        loginTime: new Date().toISOString()
                    };
                }
                return null;
            }

            async handleAdminRegistration(e) {
                e.preventDefault();
                
                const name = document.getElementById('adminRegName').value;
                const email = document.getElementById('adminRegEmail').value;
                const password = document.getElementById('adminRegPassword').value;
                const reason = document.getElementById('adminRegReason').value;
                
                // Simulate registration request
                showCustomAlert('Admin registration request submitted. You will be notified once approved.', 'success');
                this.hideAdminRegistration();
            }

            showDashboard() {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                document.getElementById('adminName').textContent = this.currentAdmin.name;
                document.getElementById('logoutBtn').style.display = 'block';
                
                this.updateDashboardStats();
                this.loadManagedUsers();
            }

            updateDashboardStats() {
                document.getElementById('totalManagedUsers').textContent = this.managedUsers.length;
                document.getElementById('totalModifications').textContent = this.activityLog.filter(log => 
                    log.date === new Date().toDateString() && log.type === 'edit'
                ).length;
                document.getElementById('lastActivity').textContent = this.activityLog.length > 0 ? 
                    new Date(this.activityLog[this.activityLog.length - 1].timestamp).toLocaleTimeString() : 'Never';
                document.getElementById('adminLevel').textContent = `Level ${this.currentAdmin.level}`;
            }

            async loadManagedUsers() {
                // In real implementation, load users assigned to this admin
                // For demo, show sample users
                this.managedUsers = [
                    { email: 'user1@example.com', name: 'John Doe', coins: 150, status: 'active' },
                    { email: 'user2@example.com', name: 'Jane Smith', coins: 200, status: 'active' }
                ];
                this.displayManagedUsers();
            }

            displayManagedUsers() {
                const container = document.getElementById('managedUsersList');
                container.innerHTML = '';
                
                if (this.managedUsers.length === 0) {
                    container.innerHTML = '<p class="text-white/70 text-center">No users assigned for management</p>';
                    return;
                }
                
                this.managedUsers.forEach(user => {
                    const userCard = this.createUserCard(user);
                    container.appendChild(userCard);
                });
            }

            createUserCard(user) {
                const card = document.createElement('div');
                card.className = 'user-card glass rounded-xl p-4 flex items-center justify-between';
                card.onclick = () => this.editUser(user);
                
                card.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">${user.name}</h4>
                            <p class="text-sm text-white/70">${user.email}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2">
                            <span class="text-yellow-400 font-bold">${user.coins} coins</span>
                            <span class="px-2 py-1 rounded-full text-xs ${user.status === 'active' ? 'bg-green-500' : 'bg-red-500'} text-white">
                                ${user.status}
                            </span>
                        </div>
                        <button class="text-blue-400 hover:text-blue-300 text-sm mt-1">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                    </div>
                `;
                
                return card;
            }

            async searchUsers() {
                const query = document.getElementById('userSearchInput').value.trim();
                if (!query) {
                    showCustomAlert('Please enter search terms', 'warning');
                    return;
                }
                
                try {
                    // Simulate user search
                    const results = await this.performUserSearch(query);
                    this.displaySearchResults(results);
                } catch (error) {
                    showCustomAlert('Search failed. Please try again.', 'error');
                }
            }

            async performUserSearch(query) {
                // For demo, return sample results
                return [
                    { 
                        name: 'Sadiya Rohman', 
                        email: 'mustshadia@gmail.com', 
                        phone: '+8801783966643',
                        coins: 10, 
                        status: 'active',
                        hasPermission: true 
                    },
                    { 
                        name: 'Test User', 
                        email: 'test@example.com', 
                        phone: '+8801234567890',
                        coins: 50, 
                        status: 'active',
                        hasPermission: false 
                    }
                ].filter(user => 
                    user.name.toLowerCase().includes(query.toLowerCase()) ||
                    user.email.toLowerCase().includes(query.toLowerCase()) ||
                    user.phone.includes(query)
                );
            }

            displaySearchResults(results) {
                const container = document.getElementById('searchResults');
                container.innerHTML = '';
                
                if (results.length === 0) {
                    container.innerHTML = '<p class="text-white/70 text-center">No users found matching your search</p>';
                    return;
                }
                
                results.forEach(user => {
                    const userCard = this.createSearchResultCard(user);
                    container.appendChild(userCard);
                });
            }

            createSearchResultCard(user) {
                const card = document.createElement('div');
                card.className = `user-card glass rounded-xl p-4 flex items-center justify-between ${!user.hasPermission ? 'opacity-60' : ''}`;
                
                card.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">${user.name}</h4>
                            <p class="text-sm text-white/70">${user.email}</p>
                            <p class="text-xs text-white/60">${user.phone}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-yellow-400 font-bold">${user.coins} coins</span>
                        </div>
                        ${user.hasPermission ? 
                            `<button onclick="adminPanel.editUser(${JSON.stringify(user).replace(/"/g, '&quot;')})" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-lg text-sm transition-all">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </button>` :
                            `<span class="text-red-400 text-sm">
                                <i class="fas fa-lock mr-1"></i>No Permission
                            </span>`
                        }
                    </div>
                `;
                
                return card;
            }

            async editUser(user) {
                this.selectedUser = user;
                
                // Load full user data
                const fullUserData = await this.loadFullUserData(user.email);
                if (!fullUserData) {
                    showCustomAlert('Failed to load user data', 'error');
                    return;
                }
                
                this.populateEditForm(fullUserData);
                document.getElementById('userEditModal').classList.remove('hidden');
            }

            async loadFullUserData(email) {
                try {
                    // For demo, return sample full data
                    return {
                        name: "Sadiya Rohman",
                        phone: "+8801783966643",
                        email: "mustshadia@gmail.com",
                        address: "Rajshahi",
                        coins: 10,
                        diamonds: 0,
                        earnings: 0,
                        activities: 0,
                        referrals: 0,
                        streak: 1,
                        referralCode: "REF4KP6UG279",
                        usedReferralCode: "34567891",
                        joinDate: "2025-07-08T18:23:55.279Z",
                        lastLogin: "2025-07-16T00:19:29.920Z",
                        lastLoginDate: "Wed Jul 16 2025",
                        lastActivity: "2025-07-10T01:39:32.376Z",
                        lastUnlockDate: null,
                        dailyUnlockedGames: false,
                        dailyUnlockedVideos: false,
                        isEmailVerified: true,
                        isActive: true,
                        verificationCode: "762446",
                        totalEarningsLifetime: 0.000009999999999999999,
                        totalActivitiesCompleted: 0,
                        loginStreak: 1,
                        lastStreakUpdate: "Wed Jul 16 2025",
                        achievementPoints: 0,
                        profilePicture: "",
                        bio: "",
                        location: "Rajshahi",
                        dateOfBirth: "",
                        gender: "",
                        preferredLanguage: "en"
                    };
                } catch (error) {
                    console.error('Load user data error:', error);
                    return null;
                }
            }

            populateEditForm(userData) {
                document.getElementById('editUserId').value = userData.email;
                document.getElementById('editUserName').value = userData.name || '';
                document.getElementById('editUserEmail').value = userData.email || '';
                document.getElementById('editUserCoins').value = userData.coins || 0;
                document.getElementById('editUserDiamonds').value = userData.diamonds || 0;
                document.getElementById('editUserEarnings').value = userData.earnings || userData.totalEarningsLifetime || 0;
                document.getElementById('editUserStreak').value = userData.streak || userData.loginStreak || 0;
                document.getElementById('editAchievementPoints').value = userData.achievementPoints || 0;
                document.getElementById('editIsActive').value = userData.isActive ? 'true' : 'false';
                document.getElementById('editDailyUnlockedGames').value = userData.dailyUnlockedGames ? 'true' : 'false';
                document.getElementById('editDailyUnlockedVideos').value = userData.dailyUnlockedVideos ? 'true' : 'false';
                document.getElementById('editUserLocation').value = userData.location || '';
                document.getElementById('editUserGender').value = userData.gender || 'Not specified';
                document.getElementById('editUserBio').value = userData.bio || '';
                
                // Store original values for validation
                document.getElementById('originalCoins').textContent = userData.coins || 0;
                document.getElementById('originalEarnings').textContent = (userData.earnings || userData.totalEarningsLifetime || 0).toFixed(2);
            }

            validateCoinsInput(e) {
                const originalCoins = parseInt(document.getElementById('originalCoins').textContent);
                const newValue = parseInt(e.target.value);
                
                if (newValue > originalCoins) {
                    e.target.value = originalCoins;
                    showCustomAlert('You can only decrease coins, not increase them', 'warning');
                }
            }

            validateEarningsInput(e) {
                const originalEarnings = parseFloat(document.getElementById('originalEarnings').textContent);
                const newValue = parseFloat(e.target.value);
                
                if (newValue > originalEarnings) {
                    e.target.value = originalEarnings;
                    showCustomAlert('You can only decrease earnings, not increase them', 'warning');
                }
            }

            async handleUserEdit(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const userData = {};
                
                // Collect form data
                userData.email = document.getElementById('editUserId').value;
                userData.coins = parseInt(document.getElementById('editUserCoins').value);
                userData.diamonds = parseInt(document.getElementById('editUserDiamonds').value);
                userData.earnings = parseFloat(document.getElementById('editUserEarnings').value);
                userData.streak = parseInt(document.getElementById('editUserStreak').value);
                userData.achievementPoints = parseInt(document.getElementById('editAchievementPoints').value);
                userData.isActive = document.getElementById('editIsActive').value === 'true';
                userData.dailyUnlockedGames = document.getElementById('editDailyUnlockedGames').value === 'true';
                userData.dailyUnlockedVideos = document.getElementById('editDailyUnlockedVideos').value === 'true';
                userData.location = document.getElementById('editUserLocation').value;
                userData.bio = document.getElementById('editUserBio').value;
                userData.lastUpdated = new Date().toISOString();
                userData.updatedBy = this.currentAdmin.email;
                
                try {
                    const success = await this.saveUserData(userData);
                    if (success) {
                        showCustomAlert('User data updated successfully', 'success');
                        this.logActivity('edit', `Modified user ${userData.email}`);
                        this.closeUserEditModal();
                        this.updateDashboardStats();
                    } else {
                        showCustomAlert('Failed to update user data', 'error');
                    }
                } catch (error) {
                    showCustomAlert('Error saving user data', 'error');
                }
            }

            async saveUserData(userData) {
                try {
                    // Simulate saving to server
                    console.log('Saving user data:', userData);
                    return true; // Simulate success
                } catch (error) {
                    console.error('Save error:', error);
                    return false;
                }
            }

            logActivity(type, description) {
                const activity = {
                    type: type,
                    description: description,
                    timestamp: new Date().toISOString(),
                    admin: this.currentAdmin.email,
                    date: new Date().toDateString()
                };
                
                this.activityLog.push(activity);
                this.updateActivityLog();
            }

            updateActivityLog() {
                const container = document.getElementById('adminActivityLog');
                container.innerHTML = '';
                
                if (this.activityLog.length === 0) {
                    container.innerHTML = '<p class="text-white/70 text-center">No activity recorded</p>';
                    return;
                }
                
                this.activityLog.slice(-10).reverse().forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'flex items-center justify-between p-3 border-b border-white/10';
                    
                    activityElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r ${this.getActivityColor(activity.type)} rounded-full flex items-center justify-center">
                                <i class="${this.getActivityIcon(activity.type)} text-white text-sm"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-sm">${activity.description}</p>
                                <p class="text-xs text-white/70">${new Date(activity.timestamp).toLocaleString()}</p>
                            </div>
                        </div>
                        <span class="text-xs text-white/60">${activity.type}</span>
                    `;
                    
                    container.appendChild(activityElement);
                });
            }

            getActivityColor(type) {
                const colors = {
                    'login': 'from-green-500 to-emerald-500',
                    'edit': 'from-blue-500 to-cyan-500',
                    'view': 'from-purple-500 to-indigo-500'
                };
                return colors[type] || 'from-gray-500 to-gray-600';
            }

            getActivityIcon(type) {
                const icons = {
                    'login': 'fas fa-sign-in-alt',
                    'edit': 'fas fa-edit',
                    'view': 'fas fa-eye'
                };
                return icons[type] || 'fas fa-circle';
            }

            switchTab(tabName) {
                this.currentTab = tabName;
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('tab-active');
                });
                document.getElementById(tabName + 'Tab').classList.add('tab-active');
                
                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + 'TabContent').classList.remove('hidden');
            }

            closeUserEditModal() {
                document.getElementById('userEditModal').classList.add('hidden');
                this.selectedUser = null;
            }

            showAdminRegistration() {
                document.getElementById('adminRegistrationModal').classList.remove('hidden');
            }

            hideAdminRegistration() {
                document.getElementById('adminRegistrationModal').classList.add('hidden');
            }

            logoutAdmin() {
                localStorage.removeItem('adminSession');
                this.currentAdmin = null;
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('dashboardSection').classList.add('hidden');
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('adminName').textContent = 'Not Logged In';
            }
        }

        // Global functions
        function showCustomAlert(message, type = 'info') {
            const alertIcon = document.getElementById('alertIcon');
            const alertMessage = document.getElementById('alertMessage');
            const customAlert = document.getElementById('customAlert');
            
            alertMessage.textContent = message;
            
            switch(type) {
                case 'success':
                    alertIcon.className = 'fas fa-check-circle text-5xl mb-4 text-green-400';
                    break;
                case 'error':
                    alertIcon.className = 'fas fa-exclamation-circle text-5xl mb-4 text-red-400';
                    break;
                case 'warning':
                    alertIcon.className = 'fas fa-exclamation-triangle text-5xl mb-4 text-yellow-400';
                    break;
                default:
                    alertIcon.className = 'fas fa-info-circle text-5xl mb-4 text-blue-400';
            }
            
            customAlert.classList.remove('hidden');
        }

        function hideCustomAlert() {
            document.getElementById('customAlert').classList.add('hidden');
        }

        function switchTab(tabName) {
            adminPanel.switchTab(tabName);
        }

        function searchUsers() {
            adminPanel.searchUsers();
        }

        function closeUserEditModal() {
            adminPanel.closeUserEditModal();
        }

        function showAdminRegistration() {
            adminPanel.showAdminRegistration();
        }

        function hideAdminRegistration() {
            adminPanel.hideAdminRegistration();
        }

        function logoutAdmin() {
            adminPanel.logoutAdmin();
        }

        // Initialize admin panel
        const adminPanel = new AdminPanel();

        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</body>
</html>
