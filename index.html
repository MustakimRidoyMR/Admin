<!DOCTYPE html>
<html lang="en">
<head>
     <!--PropellerAds-->
    <script src="https://fpyf8.com/88/tag.min.js" data-zone="157210" async data-cfasync="false"></script>

    <script type='text/javascript' src='//pl26717244.profitableratecpm.com/bf/51/a4/bf51a42d984554beaaed4a58dcdb733d.js'></script>
    <script type='text/javascript' src='//pl26713337.profitableratecpm.com/64/66/f1/6466f1b7fea6c93f404f4ab49960b99c.js'></script>
    <script async="async" data-cfasync="false" src="//pl26713372.profitableratecpm.com/1a6d5fbc149d94ff8c697b1327966995/invoke.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinEarner Pro - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        admin: {
                            400: '#8b5cf6',
                            500: '#7c3aed',
                            600: '#6d28d9'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .dark .glass {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .dark .glass-input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
        
        .dark .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }
        
        .admin-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            max-width: 600px;
            width: 90%;
            margin: 1rem;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .hidden { display: none !important; }
        
        .nav-tab {
            position: relative;
            padding: 12px 24px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-tab.active {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 3px;
            background: #8b5cf6;
            border-radius: 2px;
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .user-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .permission-badge {
            background: linear-gradient(45deg, #10b981, #34d399);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .restricted-badge {
            background: linear-gradient(45deg, #ef4444, #f87171);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .input-base {
            font-size: 16px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .search-highlight {
            background: yellow;
            color: black;
            padding: 1px 3px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="gradient-bg text-white overflow-x-hidden">
    
    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="adminLoginModal">
        <div class="modal-content glass rounded-2xl p-8">
            <div class="text-center mb-8">
                <i class="fas fa-shield-alt text-6xl text-admin-500 mb-4"></i>
                <h2 class="text-3xl font-bold mb-2">Admin Access</h2>
                <p class="text-white/80">Limited Admin Panel Login</p>
            </div>
            
            <div class="flex justify-center mb-6">
                <div class="flex bg-white/10 rounded-xl p-1">
                    <button id="loginTab" class="tab-btn active px-6 py-2 rounded-lg transition-all">Login</button>
                    <button id="registerTab" class="tab-btn px-6 py-2 rounded-lg transition-all">Register</button>
                </div>
            </div>
            
            <!-- Login Form -->
            <form id="adminLoginForm" class="space-y-4">
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Admin Email</label>
                    <input type="email" id="adminEmail" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter admin email">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Admin Password</label>
                    <input type="password" id="adminPassword" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter admin password">
                </div>
                <button type="submit" class="w-full admin-gradient text-white py-3 px-6 rounded-xl hover:opacity-90 font-semibold transition-all">
                    <i class="fas fa-sign-in-alt mr-2"></i>Admin Login
                </button>
            </form>
            
            <!-- Register Form -->
            <form id="adminRegisterForm" class="space-y-4 hidden">
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Full Name</label>
                    <input type="text" id="regAdminName" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter full name">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Email Address</label>
                    <input type="email" id="regAdminEmail" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Enter email">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Phone Number</label>
                    <input type="tel" id="regAdminPhone" required class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="+8801XXXXXXXXX">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Password</label>
                    <input type="password" id="regAdminPassword" required minlength="6" class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Create password">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Admin Code (Optional)</label>
                    <input type="text" id="regAdminCode" class="w-full px-4 py-3 glass-input rounded-xl text-white placeholder-white/50 input-base" placeholder="Special admin code (if provided)">
                    <small class="text-white/60">Leave empty for basic admin access</small>
                </div>
                <button type="submit" class="w-full admin-gradient text-white py-3 px-6 rounded-xl hover:opacity-90 font-semibold transition-all">
                    <i class="fas fa-user-plus mr-2"></i>Register as Admin
                </button>
            </form>
        </div>
    </div>

    <!-- Navigation Header -->
    <nav class="glass sticky top-0 z-50 border-b border-white/20 hidden" id="adminNav">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-shield-alt text-3xl text-admin-500"></i>
                        <span class="text-xl font-bold">Admin Panel</span>
                        <span class="permission-badge" id="adminLevel">Basic</span>
                    </div>
                    <div class="hidden md:flex space-x-4">
                        <div class="nav-tab active" onclick="showSection('dashboard')">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </div>
                        <div class="nav-tab" onclick="showSection('users')">
                            <i class="fas fa-users mr-2"></i>User Management
                        </div>
                        <div class="nav-tab" onclick="showSection('activities')">
                            <i class="fas fa-history mr-2"></i>Activities
                        </div>
                        <div class="nav-tab" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar mr-2"></i>Reports
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 glass px-3 py-2 rounded-xl">
                        <i class="fas fa-user-shield text-admin-400"></i>
                        <span id="adminName">Admin</span>
                    </div>
                    <button onclick="adminLogout()" class="glass px-4 py-2 rounded-xl hover:bg-white/20 transition-all text-red-400">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 hidden" id="adminContent">
        
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section-content">
            <!-- Admin Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-users text-4xl text-blue-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-blue-400" id="totalUsers">0</h3>
                    <p class="text-white/70 text-sm">Managed Users</p>
                </div>
                <div class="stat-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-user-check text-4xl text-green-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-green-400" id="activeUsers">0</h3>
                    <p class="text-white/70 text-sm">Active Users</p>
                </div>
                <div class="stat-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-coins text-4xl text-yellow-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-yellow-400" id="totalCoinsManaged">0</h3>
                    <p class="text-white/70 text-sm">Total Coins</p>
                </div>
                <div class="stat-card glass rounded-2xl p-6 text-center">
                    <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-3"></i>
                    <h3 class="text-2xl font-bold text-red-400" id="pendingIssues">0</h3>
                    <p class="text-white/70 text-sm">Pending Issues</p>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-6">
                    <i class="fas fa-bolt text-yellow-400 mr-2"></i>
                    Quick Actions
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="showAddCoinsModal()" class="bg-green-500 hover:bg-green-600 p-4 rounded-xl transition-all text-left">
                        <i class="fas fa-plus-circle text-2xl mb-2"></i>
                        <h4 class="font-bold">Add Coins</h4>
                        <p class="text-sm opacity-80">Add coins to user account</p>
                    </button>
                    <button onclick="showUserSearchModal()" class="bg-blue-500 hover:bg-blue-600 p-4 rounded-xl transition-all text-left">
                        <i class="fas fa-search text-2xl mb-2"></i>
                        <h4 class="font-bold">Find User</h4>
                        <p class="text-sm opacity-80">Search and manage users</p>
                    </button>
                    <button onclick="showActivityLogModal()" class="bg-purple-500 hover:bg-purple-600 p-4 rounded-xl transition-all text-left">
                        <i class="fas fa-list text-2xl mb-2"></i>
                        <h4 class="font-bold">Activity Log</h4>
                        <p class="text-sm opacity-80">View recent activities</p>
                    </button>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-6">
                    <i class="fas fa-clock text-blue-400 mr-2"></i>
                    Recent Admin Activities
                </h3>
                <div class="space-y-3" id="recentAdminActivities">
                    <p class="text-white/70 text-center">Loading activities...</p>
                </div>
            </div>
        </div>

        <!-- User Management Section -->
        <div id="usersSection" class="section-content hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">
                    <i class="fas fa-users text-blue-400 mr-3"></i>
                    User Management
                </h2>
                <div class="flex space-x-3">
                    <input type="text" id="userSearchInput" placeholder="Search users..." class="glass-input px-4 py-2 rounded-xl text-white input-base">
                    <button onclick="searchUsers()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-xl transition-all">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <!-- User List -->
            <div class="glass rounded-2xl p-6">
                <div class="table-responsive">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">User</th>
                                <th class="text-left p-3">Email</th>
                                <th class="text-left p-3">Coins</th>
                                <th class="text-left p-3">Status</th>
                                <th class="text-left p-3">Last Login</th>
                                <th class="text-left p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr>
                                <td colspan="6" class="text-center p-6 text-white/70">Loading users...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Activities Section -->
        <div id="activitiesSection" class="section-content hidden">
            <h2 class="text-3xl font-bold mb-8">
                <i class="fas fa-history text-purple-400 mr-3"></i>
                Activity Monitor
            </h2>

            <!-- Activity Filters -->
            <div class="glass rounded-2xl p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select id="activityTypeFilter" class="glass-input px-4 py-2 rounded-xl text-white">
                        <option value="">All Activities</option>
                        <option value="login">Login</option>
                        <option value="coins_earned">Coins Earned</option>
                        <option value="withdrawal">Withdrawal</option>
                        <option value="referral">Referral</option>
                    </select>
                    <select id="activityDateFilter" class="glass-input px-4 py-2 rounded-xl text-white">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="all">All Time</option>
                    </select>
                    <input type="text" id="activityUserFilter" placeholder="Filter by user..." class="glass-input px-4 py-2 rounded-xl text-white input-base">
                    <button onclick="filterActivities()" class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-xl transition-all">
                        <i class="fas fa-filter mr-2"></i>Filter
                    </button>
                </div>
            </div>

            <!-- Activity List -->
            <div class="glass rounded-2xl p-6">
                <div class="space-y-4" id="activityList">
                    <p class="text-white/70 text-center">Loading activities...</p>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reportsSection" class="section-content hidden">
            <h2 class="text-3xl font-bold mb-8">
                <i class="fas fa-chart-bar text-green-400 mr-3"></i>
                Reports & Analytics
            </h2>

            <!-- Report Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4">Daily Summary</h3>
                    <div class="space-y-3" id="dailySummary">
                        <div class="flex justify-between">
                            <span>New Users Today:</span>
                            <span class="font-bold text-green-400" id="newUsersToday">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Logins:</span>
                            <span class="font-bold text-blue-400" id="totalLoginsToday">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Coins Distributed:</span>
                            <span class="font-bold text-yellow-400" id="coinsDistributedToday">0</span>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4">Admin Permissions</h3>
                    <div class="space-y-2" id="adminPermissions">
                        <div class="flex justify-between">
                            <span>User Management:</span>
                            <span class="permission-badge">Granted</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Coin Management:</span>
                            <span class="permission-badge">Limited</span>
                        </div>
                        <div class="flex justify-between">
                            <span>System Settings:</span>
                            <span class="restricted-badge">Restricted</span>
                        </div>
                        <div class="flex justify-between">
                            <span>User Data Export:</span>
                            <span class="restricted-badge">Restricted</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4">Export Reports</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="exportUserReport()" class="bg-blue-500 hover:bg-blue-600 p-4 rounded-xl transition-all">
                        <i class="fas fa-users text-2xl mb-2"></i>
                        <h4 class="font-bold">User Report</h4>
                        <p class="text-sm opacity-80">Export managed users data</p>
                    </button>
                    <button onclick="exportActivityReport()" class="bg-green-500 hover:bg-green-600 p-4 rounded-xl transition-all">
                        <i class="fas fa-activity text-2xl mb-2"></i>
                        <h4 class="font-bold">Activity Report</h4>
                        <p class="text-sm opacity-80">Export activity logs</p>
                    </button>
                    <button onclick="exportSummaryReport()" class="bg-purple-500 hover:bg-purple-600 p-4 rounded-xl transition-all">
                        <i class="fas fa-chart-pie text-2xl mb-2"></i>
                        <h4 class="font-bold">Summary Report</h4>
                        <p class="text-sm opacity-80">Export summary statistics</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add Coins Modal -->
    <div class="modal-overlay hidden" id="addCoinsModal">
        <div class="modal-content glass rounded-2xl p-8">
            <h2 class="text-2xl font-bold mb-6">
                <i class="fas fa-plus-circle text-green-400 mr-2"></i>
                Add Coins to User
            </h2>
            <form id="addCoinsForm" class="space-y-4">
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">User Email</label>
                    <input type="email" id="coinUserEmail" required class="w-full px-4 py-3 glass-input rounded-xl text-white input-base" placeholder="Enter user email">
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Amount</label>
                    <input type="number" id="coinAmount" required min="1" max="1000" class="w-full px-4 py-3 glass-input rounded-xl text-white input-base" placeholder="Enter coin amount">
                    <small class="text-white/60">Maximum 1000 coins per transaction</small>
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Reason</label>
                    <select id="coinReason" required class="w-full px-4 py-3 glass-input rounded-xl text-white">
                        <option value="">Select reason</option>
                        <option value="bonus">Bonus Reward</option>
                        <option value="correction">Balance Correction</option>
                        <option value="compensation">Compensation</option>
                        <option value="promotion">Promotional Bonus</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white/80 text-sm font-medium mb-2">Notes (Optional)</label>
                    <textarea id="coinNotes" rows="3" class="w-full px-4 py-3 glass-input rounded-xl text-white" placeholder="Additional notes..."></textarea>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-xl font-semibold transition-all">
                        Add Coins
                    </button>
                    <button type="button" onclick="hideAddCoinsModal()" class="flex-1 glass text-white py-3 px-6 rounded-xl hover:bg-white/20 font-semibold transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal-overlay hidden" id="userDetailsModal">
        <div class="modal-content glass rounded-2xl p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-user text-blue-400 mr-2"></i>
                    User Details
                </h2>
                <button onclick="hideUserDetailsModal()" class="text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="userDetailsContent">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div class="modal-overlay hidden" id="customAlert">
        <div class="modal-content glass rounded-2xl p-8 text-center">
            <i id="alertIcon" class="fas fa-info-circle text-5xl mb-4"></i>
            <p id="alertMessage" class="text-xl mb-6 text-white"></p>
            <button onclick="hideCustomAlert()" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-xl hover:from-blue-600 hover:to-purple-700 font-semibold transition-all">
                OK
            </button>
        </div>
    </div>

    <script>
        // Admin Management System
        const config = {
            apiEndpoint: 'https://script.google.com/macros/s/AKfycbwzeoNtCleXecmpyEpfQMiZxNHizvl84nUipSj1FxTySFVhQrT-3K9Oo_7FiidM5HPL/exec',
            appVersion: '3.0.0-admin'
        };

        class AdminManager {
            constructor() {
                this.currentAdmin = null;
                this.managedUsers = [];
                this.adminPermissions = {
                    userManagement: true,
                    coinManagement: true,
                    dataExport: false,
                    systemSettings: false,
                    unlimited: false
                };
                this.init();
            }

            init() {
                this.checkAdminSession();
                this.setupEventListeners();
                this.loadDashboardData();
            }

            checkAdminSession() {
                const storedAdmin = localStorage.getItem('currentAdmin');
                if (storedAdmin) {
                    try {
                        this.currentAdmin = JSON.parse(storedAdmin);
                        this.showAdminPanel();
                    } catch (e) {
                        localStorage.removeItem('currentAdmin');
                        this.showAdminLogin();
                    }
                } else {
                    this.showAdminLogin();
                }
            }

            showAdminLogin() {
                document.getElementById('adminLoginModal').classList.remove('hidden');
                document.getElementById('adminNav').classList.add('hidden');
                document.getElementById('adminContent').classList.add('hidden');
            }

            showAdminPanel() {
                document.getElementById('adminLoginModal').classList.add('hidden');
                document.getElementById('adminNav').classList.remove('hidden');
                document.getElementById('adminContent').classList.remove('hidden');
                
                if (this.currentAdmin) {
                    document.getElementById('adminName').textContent = this.currentAdmin.name;
                    this.updateAdminLevel();
                    this.loadManagedUsers();
                }
            }

            updateAdminLevel() {
                const levelBadge = document.getElementById('adminLevel');
                if (this.currentAdmin.adminCode === 'SUPER_ADMIN_2024') {
                    levelBadge.textContent = 'Super Admin';
                    levelBadge.className = 'permission-badge';
                    this.adminPermissions.unlimited = true;
                } else if (this.currentAdmin.adminCode) {
                    levelBadge.textContent = 'Advanced';
                    levelBadge.className = 'permission-badge';
                } else {
                    levelBadge.textContent = 'Basic';
                    levelBadge.className = 'restricted-badge';
                }
            }

            setupEventListeners() {
                // Tab switching
                document.getElementById('loginTab').addEventListener('click', () => this.switchTab('login'));
                document.getElementById('registerTab').addEventListener('click', () => this.switchTab('register'));

                // Form submissions
                document.getElementById('adminLoginForm').addEventListener('submit', (e) => this.handleAdminLogin(e));
                document.getElementById('adminRegisterForm').addEventListener('submit', (e) => this.handleAdminRegister(e));
                document.getElementById('addCoinsForm').addEventListener('submit', (e) => this.handleAddCoins(e));

                // Search functionality
                document.getElementById('userSearchInput').addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') this.searchUsers();
                });
            }

            switchTab(tab) {
                const loginForm = document.getElementById('adminLoginForm');
                const registerForm = document.getElementById('adminRegisterForm');
                const loginTab = document.getElementById('loginTab');
                const registerTab = document.getElementById('registerTab');

                if (tab === 'login') {
                    loginForm.classList.remove('hidden');
                    registerForm.classList.add('hidden');
                    loginTab.classList.add('active');
                    registerTab.classList.remove('active');
                } else {
                    loginForm.classList.add('hidden');
                    registerForm.classList.remove('hidden');
                    loginTab.classList.remove('active');
                    registerTab.classList.add('active');
                }
            }

            async handleAdminLogin(e) {
                e.preventDefault();
                
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;

                try {
                    const adminData = await this.validateAdmin(email, password);
                    if (adminData) {
                        this.currentAdmin = adminData;
                        localStorage.setItem('currentAdmin', JSON.stringify(adminData));
                        this.showAdminPanel();
                        showCustomAlert('Admin login successful!', 'success');
                    } else {
                        showCustomAlert('Invalid admin credentials!', 'error');
                    }
                } catch (error) {
                    showCustomAlert('Login failed. Please try again.', 'error');
                }
            }

            async handleAdminRegister(e) {
                e.preventDefault();
                
                const adminData = {
                    name: document.getElementById('regAdminName').value,
                    email: document.getElementById('regAdminEmail').value,
                    phone: document.getElementById('regAdminPhone').value,
                    password: document.getElementById('regAdminPassword').value,
                    adminCode: document.getElementById('regAdminCode').value || null,
                    registrationDate: new Date().toISOString(),
                    isActive: true,
                    permissions: this.getPermissionsByCode(document.getElementById('regAdminCode').value)
                };

                try {
                    const success = await this.registerAdmin(adminData);
                    if (success) {
                        showCustomAlert('Admin registration successful! Please login.', 'success');
                        this.switchTab('login');
                        
                        // Clear form
                        document.getElementById('adminRegisterForm').reset();
                    } else {
                        showCustomAlert('Registration failed. Please try again.', 'error');
                    }
                } catch (error) {
                    showCustomAlert('Registration failed. Please try again.', 'error');
                }
            }

            getPermissionsByCode(code) {
                if (code === 'SUPER_ADMIN_2024') {
                    return {
                        userManagement: true,
                        coinManagement: true,
                        dataExport: true,
                        systemSettings: true,
                        unlimited: true
                    };
                } else if (code && code.length > 0) {
                    return {
                        userManagement: true,
                        coinManagement: true,
                        dataExport: true,
                        systemSettings: false,
                        unlimited: false
                    };
                } else {
                    return {
                        userManagement: true,
                        coinManagement: true,
                        dataExport: false,
                        systemSettings: false,
                        unlimited: false
                    };
                }
            }

            async validateAdmin(email, password) {
                try {
                    const filename = `admin_${email.replace('@', '_at_').replace(/\./g, '_dot_')}.json`;
                    const response = await fetch(`${config.apiEndpoint}?folder=admins&filename=${filename}`);
                    
                    if (!response.ok) return null;
                    
                    const text = await response.text();
                    if (text.includes('error') || text.includes('not found')) return null;
                    
                    const adminData = JSON.parse(text);
                    
                    // Simple password check (in production, use proper hashing)
                    if (adminData.password === password) {
                        return adminData;
                    }
                    return null;
                } catch (error) {
                    console.error('Admin validation error:', error);
                    return null;
                }
            }

            async registerAdmin(adminData) {
                try {
                    const filename = `admin_${adminData.email.replace('@', '_at_').replace(/\./g, '_dot_')}.json`;
                    const result = await fetch(config.apiEndpoint, {
                        method: 'POST',
                        body: new URLSearchParams({
                            folder: 'admins',
                            filename: filename,
                            content: JSON.stringify(adminData, null, 2)
                        })
                    });
                    return result.ok;
                } catch (error) {
                    console.error('Admin registration error:', error);
                    return false;
                }
            }

            async loadManagedUsers() {
                try {
                    // In a real app, this would load users assigned to this admin
                    // For demo, we'll load some sample users
                    this.managedUsers = await this.getManagedUsers();
                    this.updateUserTable();
                    this.updateDashboardStats();
                } catch (error) {
                    console.error('Failed to load managed users:', error);
                }
            }

            async getManagedUsers() {
                // This would typically query the server for users assigned to this admin
                // For demo purposes, we'll return sample data
                return [
                    {
                        name: "John Doe",
                        email: "john@example.com",
                        coins: 150,
                        status: "Active",
                        lastLogin: "2024-01-15",
                        isActive: true
                    },
                    {
                        name: "Jane Smith", 
                        email: "jane@example.com",
                        coins: 75,
                        status: "Active",
                        lastLogin: "2024-01-14",
                        isActive: true
                    }
                ];
            }

            updateUserTable() {
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = '';

                if (this.managedUsers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center p-6 text-white/70">No users assigned to manage</td></tr>';
                    return;
                }

                this.managedUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-white/10 hover:bg-white/5';
                    row.innerHTML = `
                        <td class="p-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold">
                                    ${user.name.charAt(0)}
                                </div>
                                <span class="font-semibold">${user.name}</span>
                            </div>
                        </td>
                        <td class="p-3">${user.email}</td>
                        <td class="p-3">
                            <span class="text-yellow-400 font-bold">${user.coins}</span>
                        </td>
                        <td class="p-3">
                            <span class="permission-badge">${user.status}</span>
                        </td>
                        <td class="p-3">${user.lastLogin}</td>
                        <td class="p-3">
                            <div class="flex space-x-2">
                                <button onclick="viewUserDetails('${user.email}')" class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-xs transition-all">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="editUserCoins('${user.email}')" class="bg-green-500 hover:bg-green-600 px-3 py-1 rounded text-xs transition-all">
                                    <i class="fas fa-coins"></i>
                                </button>
                                <button onclick="suspendUser('${user.email}')" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs transition-all">
                                    <i class="fas fa-ban"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            updateDashboardStats() {
                document.getElementById('totalUsers').textContent = this.managedUsers.length;
                document.getElementById('activeUsers').textContent = this.managedUsers.filter(u => u.isActive).length;
                document.getElementById('totalCoinsManaged').textContent = this.managedUsers.reduce((sum, u) => sum + u.coins, 0);
                document.getElementById('pendingIssues').textContent = '0'; // This would come from a support system
            }

            async loadDashboardData() {
                // Load recent admin activities
                this.loadRecentActivities();
                
                // Load daily summary
                this.loadDailySummary();
            }

            loadRecentActivities() {
                const container = document.getElementById('recentAdminActivities');
                const activities = [
                    { action: 'Added 50 coins to user john@example.com', time: '2 minutes ago', type: 'coin_add' },
                    { action: 'Viewed user profile for jane@example.com', time: '15 minutes ago', type: 'user_view' },
                    { action: 'Admin login successful', time: '1 hour ago', type: 'login' }
                ];

                container.innerHTML = '';
                activities.forEach(activity => {
                    const activityElement = document.createElement('div');
                    activityElement.className = 'flex items-center justify-between p-3 bg-white/5 rounded-lg';
                    activityElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <i class="fas ${this.getActivityIcon(activity.type)} text-blue-400"></i>
                            <span>${activity.action}</span>
                        </div>
                        <span class="text-white/70 text-sm">${activity.time}</span>
                    `;
                    container.appendChild(activityElement);
                });
            }

            loadDailySummary() {
                // This would typically come from the server
                document.getElementById('newUsersToday').textContent = '3';
                document.getElementById('totalLoginsToday').textContent = '15';
                document.getElementById('coinsDistributedToday').textContent = '250';
            }

            getActivityIcon(type) {
                const icons = {
                    'coin_add': 'fa-plus-circle',
                    'user_view': 'fa-eye',
                    'login': 'fa-sign-in-alt',
                    'user_edit': 'fa-edit'
                };
                return icons[type] || 'fa-circle';
            }

            async handleAddCoins(e) {
                e.preventDefault();
                
                const userEmail = document.getElementById('coinUserEmail').value;
                const amount = parseInt(document.getElementById('coinAmount').value);
                const reason = document.getElementById('coinReason').value;
                const notes = document.getElementById('coinNotes').value;

                if (!this.adminPermissions.coinManagement) {
                    showCustomAlert('You do not have permission to add coins', 'error');
                    return;
                }

                try {
                    const success = await this.addCoinsToUser(userEmail, amount, reason, notes);
                    if (success) {
                        showCustomAlert(`Successfully added ${amount} coins to ${userEmail}`, 'success');
                        this.hideAddCoinsModal();
                        this.loadManagedUsers(); // Refresh user data
                        this.logAdminActivity(`Added ${amount} coins to ${userEmail}`, 'coin_add');
                    } else {
                        showCustomAlert('Failed to add coins. Please try again.', 'error');
                    }
                } catch (error) {
                    showCustomAlert('An error occurred. Please try again.', 'error');
                }
            }

            async addCoinsToUser(userEmail, amount, reason, notes) {
                try {
                    // Load user data
                    const filename = userEmail.replace('@', '_at_').replace(/\./g, '_dot_') + '.json';
                    const response = await fetch(`${config.apiEndpoint}?folder=users&filename=${filename}`);
                    
                    if (!response.ok) {
                        showCustomAlert('User not found', 'error');
                        return false;
                    }
                    
                    const text = await response.text();
                    if (text.includes('error')) {
                        showCustomAlert('User not found', 'error');
                        return false;
                    }
                    
                    const userData = JSON.parse(text);
                    
                    // Add coins
                    userData.coins = (userData.coins || 0) + amount;
                    userData.lastUpdated = new Date().toISOString();
                    
                    // Log the transaction
                    if (!userData.adminTransactions) userData.adminTransactions = [];
                    userData.adminTransactions.push({
                        adminEmail: this.currentAdmin.email,
                        adminName: this.currentAdmin.name,
                        amount: amount,
                        reason: reason,
                        notes: notes,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Save updated user data
                    const saveResult = await fetch(config.apiEndpoint, {
                        method: 'POST',
                        body: new URLSearchParams({
                            folder: 'users',
                            filename: filename,
                            content: JSON.stringify(userData, null, 2)
                        })
                    });
                    
                    return saveResult.ok;
                } catch (error) {
                    console.error('Add coins error:', error);
                    return false;
                }
            }

            logAdminActivity(action, type) {
                // Log admin activities for audit trail
                const activity = {
                    adminEmail: this.currentAdmin.email,
                    action: action,
                    type: type,
                    timestamp: new Date().toISOString()
                };
                
                // In a real app, this would be saved to the server
                console.log('Admin activity logged:', activity);
            }

            hideAddCoinsModal() {
                document.getElementById('addCoinsModal').classList.add('hidden');
                document.getElementById('addCoinsForm').reset();
            }

            searchUsers() {
                const searchTerm = document.getElementById('userSearchInput').value.toLowerCase();
                const filteredUsers = this.managedUsers.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) || 
                    user.email.toLowerCase().includes(searchTerm)
                );
                
                // Update table with filtered results
                this.managedUsers = filteredUsers;
                this.updateUserTable();
            }
        }

        // Global instance
        const adminManager = new AdminManager();

        // Global functions
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(s => s.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showAddCoinsModal() {
            document.getElementById('addCoinsModal').classList.remove('hidden');
        }

        function showUserSearchModal() {
            showCustomAlert('Advanced user search coming soon!', 'info');
        }

        function showActivityLogModal() {
            showCustomAlert('Detailed activity log coming soon!', 'info');
        }

        function viewUserDetails(email) {
            showCustomAlert(`Viewing details for ${email}`, 'info');
        }

        function editUserCoins(email) {
            document.getElementById('coinUserEmail').value = email;
            showAddCoinsModal();
        }

        function suspendUser(email) {
            showCustomAlert(`User suspension feature coming soon for ${email}`, 'warning');
        }

        function filterActivities() {
            showCustomAlert('Activity filtering coming soon!', 'info');
        }

        function exportUserReport() {
            if (!adminManager.adminPermissions.dataExport) {
                showCustomAlert('You do not have permission to export data', 'error');
                return;
            }
            showCustomAlert('Exporting user report...', 'info');
        }

        function exportActivityReport() {
            if (!adminManager.adminPermissions.dataExport) {
                showCustomAlert('You do not have permission to export data', 'error');
                return;
            }
            showCustomAlert('Exporting activity report...', 'info');
        }

        function exportSummaryReport() {
            showCustomAlert('Exporting summary report...', 'info');
        }

        function adminLogout() {
            localStorage.removeItem('currentAdmin');
            adminManager.currentAdmin = null;
            adminManager.showAdminLogin();
            showCustomAlert('Admin logged out successfully!', 'success');
        }

        function hideUserDetailsModal() {
            document.getElementById('userDetailsModal').classList.add('hidden');
        }

        function showCustomAlert(message, type = 'info') {
            const alertIcon = document.getElementById('alertIcon');
            const alertMessage = document.getElementById('alertMessage');
            const customAlert = document.getElementById('customAlert');
            
            alertMessage.textContent = message;
            
            switch(type) {
                case 'success':
                    alertIcon.className = 'fas fa-check-circle text-5xl mb-4 text-green-400';
                    break;
                case 'error':
                    alertIcon.className = 'fas fa-exclamation-circle text-5xl mb-4 text-red-400';
                    break;
                case 'warning':
                    alertIcon.className = 'fas fa-exclamation-triangle text-5xl mb-4 text-yellow-400';
                    break;
                default:
                    alertIcon.className = 'fas fa-info-circle text-5xl mb-4 text-blue-400';
            }
            
            customAlert.classList.remove('hidden');
        }

        function hideCustomAlert() {
            document.getElementById('customAlert').classList.add('hidden');
        }

        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

    </script>
</body>
</html>
